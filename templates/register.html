{% extends "base.html" %}
{% block title %}تۆمارکردن{% endblock %}
{% block content %}
<h2>تۆمارکردن</h2>

<form method="post" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:780px">
  <div>
    <label for="first_name">ناو</label>
    <input id="first_name" type="text" name="first_name" required value="{{ request.form.get('first_name','') }}">
  </div>

  <div>
    <label for="father_name">ناوی باوک</label>
    <input id="father_name" type="text" name="father_name" required value="{{ request.form.get('father_name','') }}">
  </div>

  <div>
    <label for="nickname">نازناو</label>
    <input id="nickname" type="text" name="nickname" required value="{{ request.form.get('nickname','') }}">
  </div>

  <div>
    <label for="gender">ڕەگەز</label>
    <select id="gender" name="gender" required>
      {% set g = request.form.get('gender','') %}
      <option value="نێر" {{ 'selected' if g=='نێر' else '' }}>نێر</option>
      <option value="مێ" {{ 'selected' if g=='مێ' else '' }}>مێ</option>
      <option value="هیتر" {{ 'selected' if g=='هیتر' else '' }}>هیتر</option>
    </select>
  </div>

  <div>
    <label for="phone_code">کۆدی وڵات</label>
    <select id="phone_code" name="phone_code" required>
      {% set pc = request.form.get('phone_code','+964') %}
      <option value="+964" {{ 'selected' if pc=='+964' else '' }}>عێراق (+964)</option>
      <option value="+90"  {{ 'selected' if pc=='+90'  else '' }}>تۆرکیا (+90)</option>
      <option value="+98"  {{ 'selected' if pc=='+98'  else '' }}>ئێران (+98)</option>
      <option value="+963" {{ 'selected' if pc=='+963' else '' }}>سوریا (+963)</option>
      <option value="+971" {{ 'selected' if pc=='+971' else '' }}>ئیمارات (+971)</option>
      <option value="+966" {{ 'selected' if pc=='+966' else '' }}>سعوودی (+966)</option>
      <option value="+1"   {{ 'selected' if pc=='+1'   else '' }}>USA (+1)</option>
      <option value="+44"  {{ 'selected' if pc=='+44'  else '' }}>UK (+44)</option>
    </select>
  </div>

  <div>
    <label for="phone">ژمارەی مۆبایل</label>
    <input id="phone" type="text" name="phone" placeholder="7xxxxxxxxx"
           required value="{{ request.form.get('phone','') }}"
           pattern="^\d{7,15}$" title="تەنیا ژمارە، لانیکەم ٧ تا ١٥ خانە">
  </div>

  <div>
    <label for="email">ئیمەیل</label>
    <input id="email" type="email" name="email" required value="{{ request.form.get('email','') }}">
  </div>

  <div>
    <label for="username">یوزەرنەیم</label>
    <input id="username" type="text" name="username"
           placeholder="ئەگەر بەتاڵ بێت، لە ناو/ئیمەیڵ دەهێنرێتەوە"
           value="{{ request.form.get('username','') }}">
  </div>

  <div class="form-group">
    <label for="password">پاسۆرد</label>
    <input
      type="password"
      id="password"
      name="password"
      class="form-control"
      required
      minlength="8"
      pattern="(?=.*\d)(?=.*[\W_]).{8,}"
      title="پێویستە لانیکەم ٨ پیت بێت و لانیکەم ١ ژمارە و ١ هێما هەبێت"
      autocomplete="new-password"
    >
    <small class="text-muted">کەمتر نەبێت لە ٨ پیت + لانیکەم ١ ژمارە + ١ هێما</small>
  </div>

  <div class="form-group">
    <label for="confirm_password">دووبارە پاسۆرد</label>
    <input
      type="password"
      id="confirm_password"
      name="confirm_password"
      class="form-control"
      required
      minlength="8"
      autocomplete="new-password"
    >
    <small id="pwdHelp" class="text-danger"></small>
  </div>

  <div style="grid-column:1/3">
    <button class="btn" type="submit">تۆمارکردن</button>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }}" style="grid-column:1/3">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <script>
    const pwd  = document.getElementById('password');
    const cpwd = document.getElementById('confirm_password');
    const help = document.getElementById('pwdHelp');

    function checkMatch() {
      if (pwd.value && cpwd.value && pwd.value !== cpwd.value) {
        cpwd.setCustomValidity('Passwords do not match');
        help.textContent = 'پاسۆردەکان یەک ناچن';
      } else {
        cpwd.setCustomValidity('');
        help.textContent = '';
      }
    }
    pwd.addEventListener('input', checkMatch);
    cpwd.addEventListener('input', checkMatch);
  </script>
</form>
{% endblock %}
