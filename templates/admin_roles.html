{% extends "base.html" %}
{% block title %}ڕۆڵەکان (سوپەر ئەدمین){% endblock %}
{% block content %}
<h2>بەڕێوەبردنی ڕۆڵەکان</h2>

<div class="card">
  <form method="post">
    <input type="hidden" name="action" value="add">
    <div class="grid grid-3">
      <div class="row"><label>ئیمەیڵ</label><input type="email" name="email" placeholder="user@example.com" required></div>
      <div class="row"><label>ڕۆڵ</label>
        <select name="role" required>
          <option value="admin">admin</option>
          <option value="superadmin">superadmin</option>
        </select>
      </div>
      <div class="row" style="align-self:end"><button class="btn btn-primary" type="submit">زیادکردن/نوێکردن</button></div>
    </div>
    <div class="row"><small>سوپەر ئەدمینی سێدکراو: <strong>{{ seed_email }}</strong></small></div>
  </form>
</div>

<table class="table" border="1" cellpadding="8" style="margin-top:1rem">
  <thead>
    <tr><th>ID</th><th>ناو</th><th>ئیمەیڵ</th><th>ڕۆڵ</th><th>چالاکی</th></tr>
  </thead>
  <tbody>
  {% for u in users %}
    {% set _is_seq = u is sequence %}
    {% set uid = (u[0] if _is_seq else (u.id if u.id is defined else u['id'])) %}
    {% set uname = (u[1] if _is_seq else (u.username if u.username is defined else u['username'])) %}
    {% set uemail = (u[2] if _is_seq else (u.email if u.email is defined else u['email'])) %}
    {% set role = role_map.get(uid) %}
    <tr>
      <td>{{ uid }}</td>
      <td>{{ uname }}</td>
      <td>{{ uemail }}</td>
      <td>{{ role or '—' }}</td>
      <td>
        <form method="post" action="{{ url_for('admin_roles_set', user_id=uid) }}" style="display:inline-block">
          <select name="role">
            <option value="admin" {% if role=='admin' %}selected{% endif %}>admin</option>
            <option value="superadmin" {% if role=='superadmin' %}selected{% endif %}>superadmin</option>
          </select>
          <button class="btn" type="submit">دانان</button>
        </form>
        <form method="post" action="{{ url_for('admin_roles_delete', user_id=uid) }}" style="display:inline-block" onsubmit="return confirm('سڕینەوەی ڕۆڵ؟');">
          <button class="btn" type="submit">سڕینەوە</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
