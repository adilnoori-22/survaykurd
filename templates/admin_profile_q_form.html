{% extends "base.html" %}
{% block title %}{{ 'پرسیاری نوێ' if mode=='new' else 'دەستکاری پرسیار' }} — {{ pkg.title }}{% endblock %}
{% block content %}
<h2>{{ 'پرسیاری نوێ' if mode=='new' else 'دەستکاری پرسیار' }} — <span class="muted">{{ pkg.title }}</span></h2>

<form method="post" class="card" style="max-width:880px">
  <div class="grid grid-2">
    <div class="row">
      <label>دەقی پرسیار</label>
      <input name="q_text" value="{{ q.q_text if q else '' }}" required>
    </div>
    <div class="row">
      <label>جۆری پرسیار</label>
      <select name="q_type" id="q_type" required>
        {% for t in ['text','textarea','number','date','select','radio','checkbox','yesno','rating5','scale10'] %}
          <option value="{{t}}" {{ 'selected' if q and q.q_type==t }}>{{t}}</option>
        {% endfor %}
      </select>
    </div>

    <div class="row">
      <label>پێویستە؟</label>
      <select name="required">
        <option value="0" {{ '' if not q or not q.required else '' }}>نەخێر</option>
        <option value="1" {{ 'selected' if q and q.required else '' }}>بەڵێ</option>
      </select>
    </div>

    <div class="row">
      <label>پلە/جێگا</label>
      <input type="number" name="position" value="{{ q.position if q else 0 }}">
    </div>

    <div class="row" id="row-options">
      <label>ئۆپشنەکان (بۆ select/radio/checkbox — بە کۆما جیا بکە)</label>
      <textarea name="options" rows="3">{% if q and q.options %}{{ q.options|join(', ') }}{% endif %}</textarea>
    </div>

    <div class="row">
      <label>بەکاربردن بۆ فلتەری ڕاپرسی؟ (ئەرێنی)</label>
      <select name="expose_for_rules">
        <option value="0" {{ 'selected' if not q or not q.expose_for_rules else '' }}>نەخێر</option>
        <option value="1" {{ 'selected' if q and q.expose_for_rules else '' }}>بەڵێ</option>
      </select>
      <p class="muted" style="margin:.3rem 0 0">ئەگەر «بەڵێ» هەڵتبژێریت، لە لاپەڕەی مەرجەکانی ڕاپرسی دەکرێت بە فلتەر بەکاربهێنرێت.</p>
    </div>
  </div>

  <div style="margin-top:10px">
    <button class="btn" type="submit">پاشەکەوت</button>
    <a class="btn secondary" href="{{ url_for('admin_profile_schema') }}">گەرانەوە</a>
  </div>
</form>

{% block scripts %}
<script>
  function toggleOptions(){
    var t = document.getElementById('q_type').value;
    var show = ['select','radio','checkbox'].indexOf(t) >= 0;
    document.getElementById('row-options').style.display = show ? 'block' : 'none';
  }
  document.getElementById('q_type').addEventListener('change', toggleOptions);
  toggleOptions();
</script>
{% endblock %}
{% endblock %}
