{% extends "base.html" %}
{% block title %}Ú•Ø§Ù¾Ø±Ø³ÛŒ â€” Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú©Ø§Ù†{% endblock %}
{% block content %}

<style>
  /* ðŸ‘‡ ÛŒØ§Ø±Ù…Û•ØªÛŒ Ø¯ÛŒØ²Ø§ÛŒÙ† Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù† Ù‡Û•Ù…ÛŒØ´Û• Ø¯ÛŒØ§Ø±Ø¨Ù† */
  .table-wrap{ overflow-x:auto; }
  .btn-row{ display:flex; gap:.35rem; flex-wrap:wrap; }
  th.actions, td.actions{
    position: sticky; right: 0;
    background: var(--panel, #111827);
    box-shadow: -6px 0 8px rgba(0,0,0,.15);
    white-space: nowrap;
  }
  @media (max-width: 1100px){
    .grid.grid-2{ grid-template-columns: 1fr !important; }
  }
</style>

<h2>Ú•Ø§Ù¾Ø±Ø³ÛŒ: {{ survey.title }}</h2>
<p class="muted">{{ survey.description }}</p>

<div class="grid grid-2" style="grid-template-columns: 1fr 1.7fr; align-items:start; gap:1rem;">
  <!-- Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù¾Ø±Ø³ÛŒØ§Ø±ÛŒ Ù†ÙˆÛŽ -->
  <form class="card" method="post">
    <h3 style="margin-top:0">+ Ù¾Ø±Ø³ÛŒØ§Ø±ÛŒ Ù†ÙˆÛŽ</h3>
    <div class="row">
      <label>Ø¯Û•Ù‚ÛŒ Ù¾Ø±Ø³ÛŒØ§Ø±</label>
      <input type="text" name="q_text" required>
    </div>

    <div class="grid grid-2">
      <div class="row">
        <label>Ø¬Û†Ø±</label>
        <select name="q_type" id="q_type" required>
          {% for t in ['text','textarea','number','date','select','radio','checkbox','yesno','rating5','scale10'] %}
            <option value="{{t}}">{{t}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="row" style="display:flex;align-items:flex-end">
        <label style="margin:0 10px 0 0">Ù„Ø§Ø²Ù…Û•ØŸ</label>
        <input type="checkbox" name="required" style="transform:scale(1.3)">
      </div>
    </div>

    <div class="row" id="opt_row" style="display:none">
      <label>Ø¦Û†Ù¾Ø´Ù†Û•Ú©Ø§Ù† (Ø¨Û† select/radio/checkbox) â€” Ø¨Û• Ú©Û†Ù…Ø§ Ø¬ÛŒØ§ Ø¨Ú©Û•</label>
      <textarea name="options" rows="3" placeholder="Ù†Ù…ÙˆÙˆÙ†Û•: Ù‡Û•ÙˆÙ„ÛŽØ±ØŒ Ø³Ù„ÛŽÙ…Ø§Ù†ÛŒØŒ Ø¯Ù‡Û†Ú©"></textarea>
    </div>

    <div class="row">
      <label>Show If (JSON)</label>
      <textarea name="show_if_json" rows="3" placeholder='{"depends_on": 1, "equals": "yes"}'></textarea>
      <small class="muted">
        Ù†Ù…ÙˆÙˆÙ†Û•ÛŒ Ú©Û†Ù…Ù¾ÚµÛŽÚ©Ø³: <code>{"all":[{"depends_on":1,"equals":"yes"},{"depends_on":3,"gt":18}]}</code>
      </small>
    </div>

    <div class="row" style="gap:.5rem">
      <button class="btn" type="submit">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button>
      <a class="btn secondary" href="{{ url_for('admin_surveys') }}">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</a>
    </div>
  </form>

  <!-- Ù„ÛŒØ³Øª Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú©Ø§Ù† -->
  <div class="card">
    <h3 style="margin-top:0">Ù¾Ø±Ø³ÛŒØ§Ø±Û•Ú©Ø§Ù†</h3>
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Pos</th>
            <th>QID</th>
            <th>Ù¾Ø±Ø³ÛŒØ§Ø±</th>
            <th>Ø¬Û†Ø±</th>
            <th>Ù„Ø§Ø²Ù…Û•ØŸ</th>
            <th>Ø¦Û†Ù¾Ø´Ù†</th>
            <th>Show If</th>
            <th class="actions" style="width:220px">Ú©Ø±Ø¯Ø§Ø±</th>
          </tr>
        </thead>
        <tbody>
          {% for q in questions %}
            <tr id="row-{{ q.id }}">
              <td>{{ q.position }}</td>
              <td>#{{ q.id }}</td>
              <td>{{ q.q_text }}</td>
              <td>{{ q.q_type }}</td>
              <td>{{ 'âœ“' if q.required else '' }}</td>
              <td>
                {% if q.options_json %}
                  {{ q.options_json[:60] }}{% if q.options_json|length > 60 %}â€¦{% endif %}
                {% else %}-{% endif %}
              </td>
              <td>
                {% if q.show_if_json %}
                  <code style="white-space:nowrap">{{ q.show_if_json[:60] }}{% if q.show_if_json|length > 60 %}â€¦{% endif %}</code>
                {% else %}-{% endif %}
              </td>
              <td class="actions">
                <div class="btn-row">
                  <form method="post" action="{{ url_for('admin_survey_q_move', survey_id=survey.id, q_id=q.id, direction='up') }}">
                    <button class="btn small" title="Ø¨Ø³Ø±Û•ÙˆÛ•" type="submit">â†‘</button>
                  </form>
                  <form method="post" action="{{ url_for('admin_survey_q_move', survey_id=survey.id, q_id=q.id, direction='down') }}">
                    <button class="btn small" title="Ø¨Û•Ø®ÙˆØ§Ø±Û•ÙˆÛ•" type="submit">â†“</button>
                  </form>
                  <a class="btn small" href="{{ url_for('admin_survey_q_edit', survey_id=survey.id, q_id=q.id) }}">Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ</a>
                  <form method="post" action="{{ url_for('admin_survey_q_delete', survey_id=survey.id, q_id=q.id) }}" onsubmit="return confirm('Ø³Ú•ÛŒÙ†Û•ÙˆÛ• Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ');">
                    <button class="btn small danger" type="submit">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
                  </form>
                </div>
              </td>
            </tr>
          {% else %}
            <tr><td colspan="8">Ù‡ÛŒÚ† Ù¾Ø±Ø³ÛŒØ§Ø±ÛŽÚ© Ù†ÛŒÛ•.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
{% block scripts %}
<script>
  const qt = document.getElementById('q_type');
  const optRow = document.getElementById('opt_row');
  function toggleOpts(){
    const v = qt.value;
    optRow.style.display = ['select','radio','checkbox'].includes(v) ? 'block' : 'none';
  }
  if(qt){ qt.addEventListener('change', toggleOpts); toggleOpts(); }
</script>
{% endblock %}
