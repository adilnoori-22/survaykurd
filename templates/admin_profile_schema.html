{% extends "base.html" %}
{% block title %}Profile Schema (پاکێج و پرسیار) {% endblock %}
{% block content %}
<h2>سخمەسازی پڕۆفایل</h2>
<p class="muted">لەوێوە دەتوانیت پاکێج زیاد بکەیت، ناویان بگۆڕیت، و پرسیارەکان زیاد/دەستکاری/سڕینەوە بکەیت.</p>

<div class="card" style="margin-bottom:14px">
  <a class="btn" href="{{ url_for('admin_profile_pkg_new') }}">+ پاکێجی نوێ</a>
</div>

{% for pkg in packages %}
  <div class="card" style="margin-bottom:16px">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
      <div>
        <h3 style="margin:0">{{ pkg.title }}</h3>
        <div class="muted">کۆد: <code>{{ pkg.code }}</code> • پلە: {{ pkg.position }}</div>
      </div>
      <div style="display:flex;gap:8px">
        <a class="btn secondary" href="{{ url_for('admin_profile_pkg_edit', code=pkg.code) }}">دەستکاری پاکێج</a>
        <a class="btn" href="{{ url_for('admin_profile_q_new', code=pkg.code) }}">+ پرسیاری نوێ</a>
      </div>
    </div>

    <table class="table" style="margin-top:12px">
      <thead><tr>
        <th>#</th><th>پرسیار</th><th>جۆر</th><th>پێویستە؟</th><th>ئۆپشنەکان</th><th>کار</th>
      </tr></thead>
      <tbody>
      {% set rows = questions_by_pkg.get(pkg.code, []) %}
      {% for q in rows %}
        <tr>
          <td>{{ q.position }}</td>
          <td>{{ q.q_text }}</td>
          <td>{{ q.q_type }}</td>
          <td>{{ 'بەڵێ' if q.required else 'نەخێر' }}</td>
          <td>
            {% if q.options and q.options|length>0 %}
              {{ q.options|join('، ') }}
            {% else %}
              <span class="muted">-</span>
            {% endif %}
          </td>
          <td style="white-space:nowrap">
            <a class="btn small secondary" href="{{ url_for('admin_profile_q_edit', code=pkg.code, qid=q.id) }}">دەستکاری</a>
            <form style="display:inline" method="post" action="{{ url_for('admin_profile_q_delete', code=pkg.code, qid=q.id) }}" onsubmit="return confirm('سڕدرێت؟')">
              <button class="btn small danger" type="submit">سڕینەوە</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="6" class="muted">هیچ پرسیارێک نییە.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="card">هێشتا هیچ پاکێجێکت دروست نەکردووە. <a href="{{ url_for('admin_profile_pkg_new') }}">کلیک لێرە بکە بۆ زیادکردن</a>.</div>
{% endfor %}

{% endblock %}
