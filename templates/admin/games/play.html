{% extends "base.html" %}
{% block title %}Ù¾Ù„Û•ÛŒ ÛŒØ§Ø±ÛŒ â€“ {{ game.title }}
<script>window.AD_GAME_ID = {{ game.id|int }}; /* Ù‡Û•Ø±ÙˆÛ•Ù‡Ø§ room Ù„Û• Ú©ÙˆÛØ±ÛŒØŸroom=... */</script>
<script src="/static/js/ads.js"></script>      <!-- showInterstitial / creditAd -->
<script src="/static/js/ad_hooks.js"></script> <!-- Ø¦Û•Ù…Û•ÛŒ Ù†ÙˆÛ -->
<script>window.AD_IS_CLICK_GAME = true;</script>

<script>
  // Force a pre-roll at game start and block the UI until the ad is closed
  window.AD_FORCE_PREROLL = true;
  (function(){
    var gate = document.createElement('div');
    gate.id = 'ad-gate-overlay';
    gate.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1.2rem;text-align:center';
    gate.innerHTML = '<div style="background:#0b1220;border:1px solid rgba(255,255,255,.15);padding:16px 22px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.35)"><div>ğŸ¬ Ú•ÛŒÚ©Ù„Ø§Ù…ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒ ÛŒØ§Ø±ÛŒâ€¦</div><div class="muted" style="font-size:.92rem;margin-top:6px;opacity:.85">ØªÚ©Ø§ÛŒÛ• Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û• ØªØ§ Ú©Û†ØªØ§ÛŒÛŒ Ú•ÛŒÚ©Ù„Ø§Ù…</div></div>';
    document.addEventListener('DOMContentLoaded', function(){ document.body.appendChild(gate); });
    window.onInterstitialClosed = function(){ try{gate.remove();}catch(e){} };
  })();
</script>

<script src="/static/js/stake_ui.js"></script>
{% endblock %}
{% block content %}
<h2 style="display:flex;align-items:center;justify-content:space-between;gap:.6rem">
  <span>{{ game.title }}</span>
  <span style="display:inline-flex;gap:.4rem">
    {% if play_url %}
      <a class="btn small" target="_blank" rel="noopener" href="{{ play_url }}">Ú¯Û†Ú•ÛŒÙ† Ø¨Û† íƒ­ÛÚ©ÛŒ Ù†ÙˆÛ</a>
      <button id="btn-fullscreen" class="btn small" type="button" title="ÙÙˆÙ„ Ø³Ú©Ø±ÛŒÙ†">â›¶ ÙÙˆÙ„ Ø³Ú©Ø±ÛŒÙ†</button>
    {% endif %}
    <a class="btn small" href="{{ request.referrer or url_for('games_play', game_id=game.id) }}">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</a>
  </span>
</h2>

{% if room %}
  <div class="muted" style="margin-bottom:8px">Ú©Û†Ø¯ÛŒ Ú˜ÙˆÙˆØ±: <strong>{{ room }}</strong></div>
{% endif %}

{% if play_url %}
  <div id="game-wrap" style="position:relative;border-radius:14px;overflow:hidden;background:#000">
    <iframe id="game-frame"
            src="{{ play_url }}"
            width="100%" height="600"
            allow="fullscreen; autoplay; gamepad;"
            allowfullscreen
            style="border:0; display:block;"></iframe>
    <div id="embed-note" class="muted" style="display:none;position:absolute;inset:auto 0 0 0;padding:8px;background:rgba(0,0,0,.5);text-align:center">
      Ø¦Û•Ú¯Û•Ø± ÛŒØ§Ø±ÛŒÛ•Ú©Û• Ù†ÛŒØ´Ø§Ù† Ù†Û•Ø¯Ø±Ø§ØŒ Ù„Û•Ø³Û•Ø± Â«Ú¯Û†Ú•ÛŒÙ† Ø¨Û† íƒ­ÛÚ©ÛŒ Ù†ÙˆÛÂ» Ú©Ù„ÛŒÚ© Ø¨Ú©Û•â€”Ú•ÙˆÙˆÙ†Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†ÛÚ© Ù„Û• Ù…Ø§ÚµÙ¾Û•Ú•ÛŒ ÛŒØ§Ø±ÛŒÛŒÛ•Ú©Û• Ú•ÛÚ¯Ø§ÛŒ embed Ù†Ø§Ø¨Û•Ø®Ø´ÛØª.
    </div>
  </div>
{% else %}
  <div class="card">Ù‡ÛŒÚ† Play URL Ù€ÛÚ© Ø¯ÛŒØ§Ø±ÛŒÙ†Û•Ú©Ø±Ø§ÙˆÛ• Ø¨Û† Ø¦Û•Ù… ÛŒØ§Ø±ÛŒÛŒÛ•. ØªÚ©Ø§ÛŒÛ• Ù„Û• Ù„Ø§Ù¾Û•Ú•Û•ÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ† Ù¾ÛØ¯Ø§Ù†ÛŒ Ø¨Ú©Û•.</div>
{% endif %}

<script>
(function(){
  var btn = document.getElementById('btn-fullscreen');
  var frame = document.getElementById('game-frame');
  var wrap  = document.getElementById('game-wrap');
  var note  = document.getElementById('embed-note');

  if (!frame || !wrap) return;

  function requestFs(el){
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.mozRequestFullScreen) return el.mozRequestFullScreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
  }
  function exitFs(){
    if (document.exitFullscreen) return document.exitFullscreen();
    if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
    if (document.mozCancelFullScreen) return document.mozCancelFullScreen();
    if (document.msExitFullscreen) return document.msExitFullscreen();
  }
  function isFs(){
    return document.fullscreenElement || document.webkitFullscreenElement ||
           document.mozFullScreenElement || document.msFullscreenElement;
  }
  function syncFs(){
    if (isFs()){
      if (btn) btn.textContent = 'âœ• Ø¯Û•Ø±Ú†ÙˆÙˆÙ† Ù„Û• ÙÙˆÙ„ Ø³Ú©Ø±ÛŒÙ†';
      frame.style.height = (window.innerHeight || screen.height || 600) + 'px';
    } else {
      if (btn) btn.textContent = 'â›¶ ÙÙˆÙ„ Ø³Ú©Ø±ÛŒÙ†';
      frame.style.height = '600px';
    }
  }
  if (btn){
    btn.addEventListener('click', function(){
      if (!isFs()){ requestFs(wrap); } else { exitFs(); }
    });
  }
  document.addEventListener('fullscreenchange', syncFs);
  document.addEventListener('webkitfullscreenchange', syncFs);
  document.addEventListener('mozfullscreenchange', syncFs);
  document.addEventListener('MSFullscreenChange', syncFs);

  try {
    var pinged = false;
    var t = setTimeout(function(){
      if (!pinged){ note && (note.style.display='block'); }
    }, 1500);
    window.addEventListener('message', function(){ pinged = true; clearTimeout(t); }, {once:true});
    frame.contentWindow && frame.contentWindow.postMessage({ping:'embed-check'}, '*');
  } catch(e){}

  document.addEventListener('keydown', function(e){
    if (e.key && e.key.toLowerCase() === 'f'){ e.preventDefault(); if (!isFs()) requestFs(wrap); else exitFs(); }
  });
})();
</script>

<script>window.AD_GAME_ID = {{ game.id|int }};</script>
<script src="/static/js/ads.js"></script>
<script src="/static/js/ad_hooks.js"></script>


<script>
  // Force a pre-roll at game start and block the UI until the ad is closed
  window.AD_FORCE_PREROLL = true;
  (function(){
    var gate = document.createElement('div');
    gate.id = 'ad-gate-overlay';
    gate.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1.2rem;text-align:center';
    gate.innerHTML = '<div style="background:#0b1220;border:1px solid rgba(255,255,255,.15);padding:16px 22px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.35)"><div>ğŸ¬ Ú•ÛŒÚ©Ù„Ø§Ù…ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒ ÛŒØ§Ø±ÛŒâ€¦</div><div class="muted" style="font-size:.92rem;margin-top:6px;opacity:.85">ØªÚ©Ø§ÛŒÛ• Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û• ØªØ§ Ú©Û†ØªØ§ÛŒÛŒ Ú•ÛŒÚ©Ù„Ø§Ù…</div></div>';
    document.addEventListener('DOMContentLoaded', function(){ document.body.appendChild(gate); });
    window.onInterstitialClosed = function(){ try{gate.remove();}catch(e){} };
  })();
</script>

<script src="/static/js/stake_ui.js"></script>
{% endblock %}
