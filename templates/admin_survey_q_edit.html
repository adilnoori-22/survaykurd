{% extends "base.html" %}
{% block title %}دەستکاری پرسیار — ڕاپرسی #{{ survey_id }}{% endblock %}
{% block content %}
<h2>دەستکاری پرسیار (#{{ q.id }})</h2>
<form method="post" class="card" style="max-width:780px">
  <div class="row">
    <label>دەقی پرسیار</label>
    <input type="text" name="q_text" value="{{ q['q_text'] }}" required>
  </div>

  <div class="grid grid-2">
    <div class="row">
      <label>جۆر</label>
      <select name="q_type" id="q_type" required>
        {% for t in ['text','textarea','number','date','select','radio','checkbox','yesno','rating5','scale10'] %}
          <option value="{{t}}" {% if q['q_type']==t %}selected{% endif %}>{{t}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="row" style="display:flex;align-items:flex-end">
      <label style="margin:0 10px 0 0">لازمە؟</label>
      <input type="checkbox" name="required" style="transform:scale(1.3)" {% if q['required'] %}checked{% endif %}>
    </div>
  </div>

  <div class="row" id="opt_row" style="display:none">
    <label>ئۆپشنەکان (بۆ select/radio/checkbox)</label>
    <textarea name="options" rows="3" placeholder="هەولێر، سلێمانی، دهۆک">{% if q['options_json'] %}{{ q['options_json'] }}{% endif %}</textarea>
    <div class="muted">دەتوانی یان <b>JSON</b> بنووسی (وەک <code>["A","B"]</code>) یان بە کۆما جیا بکەی.</div>
  </div>

  <div class="row">
    <label>Show If (JSON)</label>
    <textarea name="show_if_json" rows="3" placeholder='{"depends_on": 3, "equals": "yes"}'>{{ q['show_if_json'] or '' }}</textarea>
  </div>

  <div class="row" style="gap:.5rem">
    <button class="btn" type="submit">پاشەکەوت</button>
    <a class="btn secondary" href="{{ url_for('admin_survey_questions', survey_id=survey_id) }}">گەڕانەوە</a>
  </div>
</form>
{% endblock %}

{% block scripts %}
<script>
  const qt = document.getElementById('q_type');
  const optRow = document.getElementById('opt_row');
  function toggleOpts(){
    const v = qt.value;
    optRow.style.display = ['select','radio','checkbox'].includes(v) ? 'block' : 'none';
  }
  qt.addEventListener('change', toggleOpts);
  toggleOpts();
</script>
{% endblock %}
