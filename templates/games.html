{% extends "base.html" %}
{% block title %}یارییەکان{% endblock %}
{% block content %}
<h2>یارییەکان</h2>

<div class="grid">
  {% set items = (games if games is defined else (rows if rows is defined else [])) %}
  {% for g in items %}
    {% set _play = (g.play_url | default('')) %}
    {% set play_href = _play if (_play and (_play.startswith('http://') or _play.startswith('https://') or _play.startswith('/'))) else ('/games/' ~ g.id ~ '/play') %}

    <div class="card" style="display:flex;flex-direction:column;gap:.6rem">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:.6rem">
        <div style="font-weight:700">{{ g.title|default('') }}</div>
        <span class="pill">{{ 'فعال' if (g.is_active|default(1)) else 'وەستاوە' }}</span>
      </div>

      <div class="row" style="gap:.5rem;flex-wrap:wrap">
        <a class="btn" target="_blank" rel="noopener" href="{{ play_href }}">▷ دەستپێکردن (تاکە-کەس)</a>
        <a class="btn secondary" target="_blank" rel="noopener" href="/games/{{ g.id }}/play">▷ پەڕەی پلەی (ناوخۆ)</a>
      </div>

      <div class="card" style="background:#0b0f1a;border:1px solid #1f2937">
        <div class="muted" style="margin-bottom:.3rem">یاریکردن لە ژوور</div>
        <div class="row" style="gap:.5rem;flex-wrap:wrap">
          <input id="room-{{ g.id }}" value="public" placeholder="کۆدی ژوور/ناو" style="width:180px">
          <button class="btn" type="button" onclick="joinRoom({{ g.id }})">بەشداری لە ژوور</button>

          <input id="roomname-{{ g.id }}" placeholder="ناوی ژوور (ئارەزوومەندانە)" style="width:220px">
          <button class="btn secondary" type="button" onclick="createRoom({{ g.id }})">+ دروستکردنی ژوور</button>
        </div>
        <div id="rooms-{{ g.id }}" style="display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.4rem"></div>
        <button class="btn small" type="button" onclick="listRooms({{ g.id }})">↻ نوێکردنەوەی ژوورەکان</button>
      </div>
    </div>
  {% else %}
    <div class="muted">هیچ یارییەک نییە.</div>
  {% endfor %}
</div>

<script src="/static/js/portal_robust.js"></script>
<script>
  (function(){
    {% set items = (games if games is defined else (rows if rows is defined else [])) %}
    {% for g in items %}
    try{ listRooms({{ g.id }}); }catch(e){}
    {% endfor %}
  })();
</script>
{% endblock %}
