<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÛŒØ§Ø±ÛŒ Ø¯Û†Ù…ÛŒÙ†Û•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .menu {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .menu h2 {
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .menu-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            padding: 20px;
            border-radius: 10px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .game-area {
            display: none;
            margin-top: 30px;
        }

        .game-board {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .players-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .player-info {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }

        .current-player {
            background: rgba(255,255,0,0.3);
            border: 2px solid #ffeb3b;
        }

        .domino-table {
            background: #2c5530;
            min-height: 250px;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 3px solid #4caf50;
            position: relative;
            overflow: auto;
        }

        .domino-line {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2px;
            margin: 10px 0;
        }

        .domino {
            width: 50px;
            height: 100px;
            background: white;
            border: 2px solid #333;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
            margin: 2px;
        }

        .domino.horizontal {
            width: 100px;
            height: 50px;
            flex-direction: row;
        }

        .domino:hover {
            transform: scale(1.05);
        }

        .domino-half {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .domino-divider {
            height: 2px;
            width: 100%;
            background: #333;
        }

        .domino.horizontal .domino-divider {
            height: 100%;
            width: 2px;
        }

        .dots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 1px;
            width: 20px;
            height: 20px;
        }

        .dot {
            width: 3px;
            height: 3px;
            background: #333;
            border-radius: 50%;
            margin: auto;
        }

        .player-hand {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            min-height: 120px;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        .btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 1em;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f44336;
        }

        .btn-secondary:hover {
            background: #da190b;
        }

        .game-status {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .boneyard-info {
            text-align: center;
            margin: 10px 0;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .winner-announcement {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        @media (max-width: 768px) {
            .players-info {
                flex-direction: column;
                align-items: center;
            }
            
            .domino {
                width: 40px;
                height: 80px;
            }
            
            .domino.horizontal {
                width: 80px;
                height: 40px;
            }
            
            .menu-buttons {
                grid-template-columns: 1fr;
            }
            
            .domino-line {
                gap: 1px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ€„ ÛŒØ§Ø±ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• ğŸ€„</h1>
        
        <div id="menu" class="menu">
            <h2>Ø¬Û†Ø±ÛŒ ÛŒØ§Ø±ÛŒ Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</h2>
            <div class="menu-buttons">
                <button class="menu-btn" onclick="startGame(2)">ğŸ¤– ÛŒØ§Ø±ÛŒ Ù„Û•Ú¯Û•Úµ Ø³ÛŒØ³ØªÙ…</button>
                <button class="menu-btn" onclick="startGame(2, false)">ğŸ‘¥ ÛŒØ§Ø±ÛŒ Ø¯ÙˆÙˆ Ú©Û•Ø³</button>
                <button class="menu-btn" onclick="startGame(3, false)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ÛŒØ§Ø±ÛŒ Ø³Û Ú©Û•Ø³</button>
                <button class="menu-btn" onclick="startGame(4, false)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ÛŒØ§Ø±ÛŒ Ú†ÙˆØ§Ø± Ú©Û•Ø³</button>
            </div>
        </div>

        <div id="gameArea" class="game-area">
            <div class="game-board">
                <div class="players-info" id="playersInfo"></div>
                
                <div class="game-status" id="gameStatus">ÛŒØ§Ø±ÛŒ Ø¯Û•Ø³Øª Ù¾Û Ø¯Û•Ú©Ø§Øª...</div>
                
                <div class="boneyard-info" id="boneyardInfo">Ø¯Û†Ù…ÛŒÙ†Û•Ú©Ø§Ù†ÛŒ Ù…Ø§ÙˆÛ•: <span id="boneyardCount">14</span></div>
                
                <div class="domino-table" id="dominoTable">
                    <div style="text-align: center; color: #4caf50; font-size: 1.2em; padding: 40px;">
                        Ù…ÛŒØ²ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• - ÛŒÛ•Ú©Û•Ù… ÛŒØ§Ø±ÛŒØ²Ø§Ù† Ø¨Û• Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯ÙˆÙˆØ¨Ù„ Ø¯Û•Ø³Øª Ù¾Û Ø¯Û•Ú©Ø§Øª
                    </div>
                </div>
                
                <div class="player-hand" id="playerHand"></div>
                
                <div class="controls">
                    <button class="btn" onclick="knockTable()" id="knockBtn">Ú©Û†Ú©Û• Ù„Û• Ù…ÛŒØ² Ø¨Ø¯Û•</button>
                    <button class="btn btn-secondary" onclick="backToMenu()">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ù…ÛÙ†ÛŒÙˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            players: [],
            currentPlayer: 0,
            playerCount: 2,
            dominoSet: [],
            playedDominoes: [],
            gameLines: [], // Ø®Û•ØªÛ•Ú©Ø§Ù†ÛŒ ÛŒØ§Ø±ÛŒ
            leftEnds: [],
            rightEnds: [],
            gameStarted: false,
            gameOver: false,
            isComputerGame: true,
            knockCount: 0,
            lastPlayedSide: 'main' // main, top, bottom
        };

        // Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ø³ÛØªÛŒ Ø¯Û†Ù…ÛŒÙ†Û• Ø¨Û• Ø³ØªØ§ÛŒÙ„ÛŒ Ø¹ÛØ±Ø§Ù‚ÛŒ (0-6)
        function createDominoSet() {
            const dominoes = [];
            for (let i = 0; i <= 6; i++) {
                for (let j = i; j <= 6; j++) {
                    dominoes.push({ 
                        left: i, 
                        right: j, 
                        id: `${i}-${j}`,
                        isDouble: i === j
                    });
                }
            }
            return shuffleArray(dominoes);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame(playerCount, withComputer = true) {
            gameState.playerCount = playerCount;
            gameState.isComputerGame = withComputer && playerCount === 2;
            gameState.dominoSet = createDominoSet();
            gameState.playedDominoes = [];
            gameState.gameLines = [[]]; // Ø®Û•ØªÛŒ Ø³Û•Ø±Û•Ú©ÛŒ
            gameState.leftEnds = [];
            gameState.rightEnds = [];
            gameState.currentPlayer = 0;
            gameState.gameStarted = true;
            gameState.gameOver = false;
            gameState.knockCount = 0;

            // Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Ø§Ù†
            gameState.players = [];
            for (let i = 0; i < playerCount; i++) {
                const isHuman = gameState.isComputerGame ? i === 0 : true;
                gameState.players.push({
                    id: i,
                    name: gameState.isComputerGame && i === 1 ? 'Ø³ÛŒØ³ØªÙ…' : `ÛŒØ§Ø±ÛŒØ²Ø§Ù† ${i + 1}`,
                    hand: [],
                    isHuman: isHuman,
                    hasKnocked: false
                });
            }

            // Ø¯Ø§Ø¨Û•Ø´Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û•Ú©Ø§Ù† (7 Ø¯Û†Ù…ÛŒÙ†Û• Ø¨Û† Ù‡Û•Ø± ÛŒØ§Ø±ÛŒØ²Ø§Ù†)
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < playerCount; j++) {
                    if (gameState.dominoSet.length > 0) {
                        gameState.players[j].hand.push(gameState.dominoSet.pop());
                    }
                }
            }

            // Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ø¯Û•Ø³Øª Ù¾ÛÚ©Û•Ø± (Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯ÙˆÙˆØ¨Ù„)
            findStartingPlayer();

            // Ø´Ø§Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù…ÛÙ†ÛŒÙˆ Ùˆ Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ ÛŒØ§Ø±ÛŒ
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';

            updateDisplay();
        }

        function findStartingPlayer() {
            let maxDouble = -1;
            let startingPlayer = 0;

            for (let i = 0; i < gameState.players.length; i++) {
                for (let domino of gameState.players[i].hand) {
                    if (domino.isDouble && domino.left > maxDouble) {
                        maxDouble = domino.left;
                        startingPlayer = i;
                    }
                }
            }

            gameState.currentPlayer = startingPlayer;

            // Ø¦Û•Ú¯Û•Ø± Ù‡ÛŒÚ† Ø¯ÙˆÙˆØ¨ÚµÛÚ© Ù†Û•Ø¨ÛØªØŒ Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯Û†Ù…ÛŒÙ†Û•
            if (maxDouble === -1) {
                let maxSum = -1;
                for (let i = 0; i < gameState.players.length; i++) {
                    for (let domino of gameState.players[i].hand) {
                        if (domino.left + domino.right > maxSum) {
                            maxSum = domino.left + domino.right;
                            startingPlayer = i;
                        }
                    }
                }
                gameState.currentPlayer = startingPlayer;
            }
        }

        function updateDisplay() {
            updatePlayersInfo();
            updateGameStatus();
            updatePlayerHand();
            updateDominoTable();
            updateBoneyardInfo();
        }

        function updatePlayersInfo() {
            const playersInfo = document.getElementById('playersInfo');
            playersInfo.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = `player-info ${index === gameState.currentPlayer ? 'current-player' : ''}`;
                const knockStatus = player.hasKnocked ? ' (Ú©Û†Ú©Û•ÛŒ Ø¯Ø§)' : '';
                playerDiv.innerHTML = `
                    <h3>${player.name}</h3>
                    <p>Ø¯Û†Ù…ÛŒÙ†Û•: ${player.hand.length}${knockStatus}</p>
                `;
                playersInfo.appendChild(playerDiv);
            });
        }

        function updateGameStatus() {
            const status = document.getElementById('gameStatus');
            if (gameState.gameOver) {
                const winner = findWinner();
                if (winner) {
                    status.innerHTML = `<div class="winner-announcement">ğŸ‰ ${winner.name} Ø¨Ø±Ø¯Û†ØªÛ•ÙˆÛ•! ğŸ‰</div>`;
                } else {
                    status.innerHTML = `<div class="winner-announcement">ğŸ¤ ÛŒØ§Ø±ÛŒ ØªÛ•ÙˆØ§Ùˆ Ø¨ÙˆÙˆ - Ù‡Ø§ÙˆØ³Û•Ù†Ú¯ÛŒ! ğŸ¤</div>`;
                }
            } else {
                const currentPlayer = gameState.players[gameState.currentPlayer];
                status.textContent = `Ù†Û†Ø¨Û•ØªÛŒ ${currentPlayer.name}Û•`;
            }
        }

        function updatePlayerHand() {
            const playerHand = document.getElementById('playerHand');
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            if (currentPlayer.isHuman) {
                playerHand.style.display = 'flex';
                playerHand.innerHTML = '';
                
                currentPlayer.hand.forEach((domino, index) => {
                    const dominoDiv = createDominoElement(domino, false);
                    dominoDiv.onclick = () => playDomino(index);
                    playerHand.appendChild(dominoDiv);
                });
            } else {
                playerHand.innerHTML = '<div style="text-align: center; padding: 20px;">Ø¯Û•Ø³ØªÛŒ Ø³ÛŒØ³ØªÙ…: ' + currentPlayer.hand.length + ' Ø¯Û†Ù…ÛŒÙ†Û•</div>';
            }
        }

        function updateDominoTable() {
            const table = document.getElementById('dominoTable');
            
            if (gameState.playedDominoes.length === 0) {
                table.innerHTML = '<div style="text-align: center; color: #4caf50; font-size: 1.2em; padding: 40px;">Ù…ÛŒØ²ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• - ÛŒÛ•Ú©Û•Ù… ÛŒØ§Ø±ÛŒØ²Ø§Ù† Ø¨Û• Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯ÙˆÙˆØ¨Ù„ Ø¯Û•Ø³Øª Ù¾Û Ø¯Û•Ú©Ø§Øª</div>';
                return;
            }

            table.innerHTML = '';
            
            // Ø®Û•ØªÛŒ Ø³Û•Ø±Û•Ú©ÛŒ
            const mainLine = document.createElement('div');
            mainLine.className = 'domino-line';
            mainLine.style.justifyContent = 'center';
            
            gameState.playedDominoes.forEach((domino, index) => {
                const dominoDiv = createDominoElement(domino, true);
                if (index === 0 && domino.isDouble) {
                    // ÛŒÛ•Ú©Û•Ù… Ø¯ÙˆÙˆØ¨Úµ Ø¨Û• Ø´ÛÙˆÛ•ÛŒ Ø³ØªÙˆÙ†ÛŒ
                    dominoDiv.classList.remove('horizontal');
                }
                mainLine.appendChild(dominoDiv);
            });
            
            table.appendChild(mainLine);
        }

        function updateBoneyardInfo() {
            document.getElementById('boneyardCount').textContent = gameState.dominoSet.length;
        }

        function createDominoElement(domino, horizontal = false) {
            const dominoDiv = document.createElement('div');
            dominoDiv.className = `domino ${horizontal ? 'horizontal' : ''}`;
            
            if (horizontal) {
                dominoDiv.innerHTML = `
                    <div class="domino-half">
                        ${createDots(domino.left)}
                    </div>
                    <div class="domino-divider"></div>
                    <div class="domino-half">
                        ${createDots(domino.right)}
                    </div>
                `;
            } else {
                dominoDiv.innerHTML = `
                    <div class="domino-half">
                        ${createDots(domino.left)}
                    </div>
                    <div class="domino-divider"></div>
                    <div class="domino-half">
                        ${createDots(domino.right)}
                    </div>
                `;
            }
            
            return dominoDiv;
        }

        function createDots(number) {
            const patterns = {
                0: [],
                1: [4],
                2: [0, 8],
                3: [0, 4, 8],
                4: [0, 2, 6, 8],
                5: [0, 2, 4, 6, 8],
                6: [0, 2, 3, 5, 6, 8]
            };
            
            let dotsHtml = '<div class="dots">';
            for (let i = 0; i < 9; i++) {
                if (patterns[number].includes(i)) {
                    dotsHtml += '<div class="dot"></div>';
                } else {
                    dotsHtml += '<div></div>';
                }
            }
            dotsHtml += '</div>';
            
            return dotsHtml;
        }

        function playDomino(dominoIndex) {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            const domino = currentPlayer.hand[dominoIndex];
            
            if (!canPlayDomino(domino)) {
                alert('Ø¦Û•Ù… Ø¯Û†Ù…ÛŒÙ†Û•Øª Ù†Ø§ØªÙˆØ§Ù†ÛŒØª Ù„Û Ø¨Ø¯Û•ÛŒØª!');
                return;
            }
            
            // Ù„Ø§Ø¨Ø±Ø¯Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• Ù„Û• Ø¯Û•Ø³ØªÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†
            currentPlayer.hand.splice(dominoIndex, 1);
            
            // Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• Ø¨Û† Ù…ÛŒØ²
            if (gameState.playedDominoes.length === 0) {
                // ÛŒÛ•Ú©Û•Ù… Ø¯Û†Ù…ÛŒÙ†Û•
                gameState.playedDominoes.push(domino);
            } else {
                // Ø¨Ú•ÛŒØ§Ø±Ø¯Ø§Ù† Ù„Û•Ø³Û•Ø± Ø´ÙˆÛÙ†ÛŒ Ø¯Ø§Ù†Ø§Ù†
                placeDomino(domino);
            }
            
            // Ú•ÛŒØ³ÛØª Ú©Ø±Ø¯Ù†ÛŒ Ú©Û†Ú©Û•
            gameState.knockCount = 0;
            gameState.players.forEach(p => p.hasKnocked = false);
            
            // Ø¨Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¦Ø§ÛŒØ§ ÛŒØ§Ø±ÛŒØ²Ø§Ù† Ø¨Ø±Ø¯Û†ØªÛ•ÙˆÛ•
            if (currentPlayer.hand.length === 0) {
                gameState.gameOver = true;
                updateDisplay();
                return;
            }
            
            // Ú¯Û†Ú•ÛŒÙ†ÛŒ Ù†Û†Ø¨Û•Øª
            nextPlayer();
            updateDisplay();
            
            // Ø¦Û•Ú¯Û•Ø± ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆ Ø³ÛŒØ³ØªÙ… Ø¨ÛØª
            if (gameState.isComputerGame && !gameState.players[gameState.currentPlayer].isHuman) {
                setTimeout(computerPlay, 1500);
            }
        }

        function canPlayDomino(domino) {
            if (gameState.playedDominoes.length === 0) return true;
            
            const leftEnd = getLeftEnd();
            const rightEnd = getRightEnd();
            
            return domino.left === leftEnd || 
                   domino.right === leftEnd ||
                   domino.left === rightEnd || 
                   domino.right === rightEnd;
        }

        function getLeftEnd() {
            if (gameState.playedDominoes.length === 0) return null;
            const firstDomino = gameState.playedDominoes[0];
            return firstDomino.left;
        }

        function getRightEnd() {
            if (gameState.playedDominoes.length === 0) return null;
            const lastDomino = gameState.playedDominoes[gameState.playedDominoes.length - 1];
            return lastDomino.right;
        }

        function placeDomino(domino) {
            const leftEnd = getLeftEnd();
            const rightEnd = getRightEnd();
            
            // Ø¨Ú•ÛŒØ§Ø± Ù„Û•Ø³Û•Ø± Ø´ÙˆÛÙ†ÛŒ Ø¨Ø§Ø´ØªØ±ÛŒÙ† Ø¨Û† Ø¯Ø§Ù†Ø§Ù†
            if (domino.right === leftEnd) {
                // Ù„Û• Ø³Û•Ø±Û•ØªØ§ Ø¯Ø§ÛŒØ¨Ù†Û
                gameState.playedDominoes.unshift({
                    left: domino.left,
                    right: domino.right,
                    isDouble: domino.isDouble
                });
            } else if (domino.left === leftEnd) {
                // Ø¨ÛŒÚ¯Û†Ú•Û• Ùˆ Ù„Û• Ø³Û•Ø±Û•ØªØ§ Ø¯Ø§ÛŒØ¨Ù†Û
                gameState.playedDominoes.unshift({
                    left: domino.right,
                    right: domino.left,
                    isDouble: domino.isDouble
                });
            } else if (domino.left === rightEnd) {
                // Ù„Û• Ú©Û†ØªØ§ÛŒÛŒ Ø¯Ø§ÛŒØ¨Ù†Û
                gameState.playedDominoes.push({
                    left: domino.left,
                    right: domino.right,
                    isDouble: domino.isDouble
                });
            } else if (domino.right === rightEnd) {
                // Ø¨ÛŒÚ¯Û†Ú•Û• Ùˆ Ù„Û• Ú©Û†ØªØ§ÛŒÛŒ Ø¯Ø§ÛŒØ¨Ù†Û
                gameState.playedDominoes.push({
                    left: domino.right,
                    right: domino.left,
                    isDouble: domino.isDouble
                });
            }
        }

        function computerPlay() {
            if (gameState.gameOver) return;
            
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            // Ú¯Û•Ú•Ø§Ù† Ø¨Û† Ø¯Û†Ù…ÛŒÙ†Û•ÛŒÛ•Ú©ÛŒ Ú¯ÙˆÙ†Ø¬Ø§Ùˆ
            let playableIndex = -1;
            let bestMove = null;
            let bestScore = -1;
            
            // Ø³ÛŒØ³ØªÙ… Ø¨Û• Ø²ÛŒØ±Û•Ú©Ø§Ù†Û• Ù‡Û•ÚµØ¯Û•Ø¨Ú˜ÛØ±ÛØª
            for (let i = 0; i < currentPlayer.hand.length; i++) {
                if (canPlayDomino(currentPlayer.hand[i])) {
                    const domino = currentPlayer.hand[i];
                    let score = domino.left + domino.right;
                    
                    // Ø¯ÙˆÙˆØ¨ÚµÛ•Ú©Ø§Ù† Ø²ÛŒØ§ØªØ± Ú¯Ø±Ù†Ú¯Ù†
                    if (domino.isDouble) score += 10;
                    
                    // Ø¦Û•Ú¯Û•Ø± Ø¨ØªÙˆØ§Ù†ÛØª ÛŒØ§Ø±ÛŒØ²Ø§Ù† Ø¨Ù„Û†Ú© Ø¨Ú©Ø§Øª
                    if (wouldBlockOpponent(domino)) score += 15;
                    
                    if (score > bestScore) {
                        bestScore = score;
                        playableIndex = i;
                        bestMove = domino;
                    }
                }
            }
            
            if (playableIndex !== -1) {
                playDomino(playableIndex);
            } else {
                // Ù†Ø§ØªÙˆØ§Ù†ÛØª ÛŒØ§Ø±ÛŒ Ø¨Ú©Ø§ØªØŒ Ø¯Û•Ø¨ÛØª Ù„Û• Ú©Û†Ú¯Ø§ Ø¨Ú©ÛØ´ÛØª
                if (gameState.dominoSet.length > 0) {
                    drawDomino();
                } else {
                    // Ú©Û†Ú¯Ø§ Ø¨Û•ØªØ§ÚµÛ•ØŒ Ú©Û†Ú©Û• Ø¯Û•Ø¯Ø§Øª
                    knockTable();
                }
            }
        }

        function wouldBlockOpponent(domino) {
            // Ø¨Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¦Ø§ÛŒØ§ Ø¦Û•Ù… Ø¯Û†Ù…ÛŒÙ†Û•ÛŒÛ• Ú•Ú©Ø§ÙˆÛ•Ø±ÛŒ Ø¨Û† ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ ØªØ± Ø¯Ø±ÙˆØ³Øª Ø¯Û•Ú©Ø§Øª
            const leftEnd = getLeftEnd();
            const rightEnd = getRightEnd();
            
            let newLeftEnd, newRightEnd;
            
            if (domino.right === leftEnd) {
                newLeftEnd = domino.left;
                newRightEnd = rightEnd;
            } else if (domino.left === leftEnd) {
                newLeftEnd = domino.right;
                newRightEnd = rightEnd;
            } else if (domino.left === rightEnd) {
                newLeftEnd = leftEnd;
                newRightEnd = domino.right;
            } else if (domino.right === rightEnd) {
                newLeftEnd = leftEnd;
                newRightEnd = domino.left;
            }
            
            // Ø¦Û•Ú¯Û•Ø± Ø¯ÙˆÙˆ Ú©Û†ØªØ§ÛŒÛŒÛ•Ú©Û• ÛŒÛ•Ú©Ø³Ø§Ù† Ø¨Ù†ØŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ ØªØ± Ø²ÛŒØ§ØªØ± Ø¯ÙˆØ¨Ø§Ø±Û•ÛŒÛŒ Ø¯Û•Ø¨ÛØª
            return newLeftEnd === newRightEnd;
        }

        function knockTable() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            // Ø¨Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¦Ø§ÛŒØ§ Ø¨Û•Ú•Ø§Ø³ØªÛŒ Ù†Ø§ØªÙˆØ§Ù†ÛØª ÛŒØ§Ø±ÛŒ Ø¨Ú©Ø§Øª
            let canPlay = false;
            for (let domino of currentPlayer.hand) {
                if (canPlayDomino(domino)) {
                    canPlay = true;
                    break;
                }
            }
            
            if (canPlay && currentPlayer.isHuman) {
                alert('ØªÛ† Ø¯Û•ØªÙˆØ§Ù†ÛŒØª ÛŒØ§Ø±ÛŒ Ø¨Ú©Û•ÛŒØª! Ù†Ø§ØªÙˆØ§Ù†ÛŒØª Ú©Û†Ú©Û• Ø¨Ø¯Û•ÛŒØª!');
                return;
            }
            
            // Ø¦Û•Ú¯Û•Ø± Ù‡ÛØ´ØªØ§ Ø¯Û†Ù…ÛŒÙ†Û• Ù„Û• Ú©Û†Ú¯Ø§ Ù‡Û•Ø¨ÛØªØŒ Ø¯Û•Ø¨ÛØª ÛŒÛ•Ú©ÛÚ© Ø¨Ú©ÛØ´ÛØª
            if (gameState.dominoSet.length > 0 && currentPlayer.isHuman) {
                alert('Ù‡ÛØ´ØªØ§ Ø¯Û†Ù…ÛŒÙ†Û• Ù„Û• Ú©Û†Ú¯Ø§ Ù‡Û•ÛŒÛ•! Ø¯Û•Ø¨ÛØª Ø¯Û†Ù…ÛŒÙ†Û• Ø¨Ú©ÛØ´ÛŒØª!');
                drawDomino();
                return;
            }
            
            currentPlayer.hasKnocked = true;
            gameState.knockCount++;
            
            // Ø¦Û•Ú¯Û•Ø± Ù‡Û•Ù…ÙˆÙˆ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Ø§Ù† Ú©Û†Ú©Û•ÛŒØ§Ù† Ø¯Ø§
            if (gameState.knockCount >= gameState.playerCount) {
                gameState.gameOver = true;
                updateDisplay();
                return;
            }
            
            // Ú¯Û†Ú•ÛŒÙ†ÛŒ Ù†Û†Ø¨Û•Øª
            nextPlayer();
            updateDisplay();
            
            // Ø¦Û•Ú¯Û•Ø± ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ø¯Ø§Ù‡Ø§ØªÙˆÙˆ Ø³ÛŒØ³ØªÙ… Ø¨ÛØª
            if (gameState.isComputerGame && !gameState.players[gameState.currentPlayer].isHuman) {
                setTimeout(computerPlay, 1000);
            }
        }

        function drawDomino() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            if (gameState.dominoSet.length === 0) {
                // Ú©Û†Ú¯Ø§ Ø¨Û•ØªØ§ÚµÛ•ØŒ Ø¯Û•ØªÙˆØ§Ù†ÛØª Ú©Û†Ú©Û• Ø¨Ø¯Ø§Øª
                if (currentPlayer.isHuman) {
                    alert('Ú©Û†Ú¯Ø§ Ø¨Û•ØªØ§ÚµÛ•! Ø¦ÛØ³ØªØ§ Ø¯Û•ØªÙˆØ§Ù†ÛŒØª Ú©Û†Ú©Û• Ø¨Ø¯Û•ÛŒØª');
                }
                return;
            }
            
            // Ú©ÛØ´Ø§Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û• Ù„Û• Ú©Û†Ú¯Ø§
            const newDomino = gameState.dominoSet.pop();
            currentPlayer.hand.push(newDomino);
            
            updateDisplay();
            
            // Ø¨Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¦Ø§ÛŒØ§ Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¨Û• Ø¯Û†Ù…ÛŒÙ†Û• ØªØ§Ø²Û•Ú©Û• ÛŒØ§Ø±ÛŒ Ø¨Ú©Ø§Øª
            if (canPlayDomino(newDomino)) {
                if (currentPlayer.isHuman) {
                    // ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ù…Ø±Û†Ú¤ Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¨Ú•ÛŒØ§Ø± Ø¨Ø¯Ø§Øª
                    return;
                } else {
                    // Ø³ÛŒØ³ØªÙ… Ø¯Û•Ø³ØªØ¨Û•Ø¬Û ÛŒØ§Ø±ÛŒ Ø¯Û•Ú©Ø§Øª
                    setTimeout(() => {
                        const dominoIndex = currentPlayer.hand.findIndex(d => d.id === newDomino.id);
                        if (dominoIndex !== -1) {
                            playDomino(dominoIndex);
                        }
                    }, 1000);
                    return;
                }
            }
            
            // Ù†Û•ÛŒØªÙˆØ§Ù†ÛŒ Ø¨Û• Ø¯Û†Ù…ÛŒÙ†Û• ØªØ§Ø²Û•Ú©Û• ÛŒØ§Ø±ÛŒ Ø¨Ú©Ø§Øª
            if (!currentPlayer.isHuman) {
                // Ø³ÛŒØ³ØªÙ… Ù‡Û•ÙˆÚµ Ø¯Û•Ø¯Ø§Øª Ø¯Û†Ù…ÛŒÙ†Û•ÛŒÛ•Ú©ÛŒ ØªØ± Ø¨Ø¯Û†Ø²ÛØªÛ•ÙˆÛ•
                setTimeout(() => {
                    let canPlayAny = false;
                    for (let i = 0; i < currentPlayer.hand.length; i++) {
                        if (canPlayDomino(currentPlayer.hand[i])) {
                            playDomino(i);
                            canPlayAny = true;
                            break;
                        }
                    }
                    
                    if (!canPlayAny) {
                        // Ù‡Û•ÙˆÚµ Ø¨Ø¯Û• Ø¯Û†Ù…ÛŒÙ†Û•ÛŒÛ•Ú©ÛŒ ØªØ± Ø¨Ú©ÛØ´ÛØª ÛŒØ§Ù† Ú©Û†Ú©Û• Ø¨Ø¯Û•
                        if (gameState.dominoSet.length > 0) {
                            drawDomino();
                        } else {
                            knockTable();
                        }
                    }
                }, 1000);
            }
        }

        function nextPlayer() {
            do {
                gameState.currentPlayer = (gameState.currentPlayer + 1) % gameState.playerCount;
            } while (gameState.players[gameState.currentPlayer].hasKnocked && gameState.knockCount < gameState.playerCount);
        }

        function findWinner() {
            if (gameState.knockCount >= gameState.playerCount) {
                // Ú©Û•Ù…ØªØ±ÛŒÙ† Ø®Ø§Úµ Ø¯Û•Ø¨Ø±Ø¯ÛØªÛ•ÙˆÛ•
                let minPoints = Infinity;
                let winner = null;
                
                for (let player of gameState.players) {
                    let points = 0;
                    for (let domino of player.hand) {
                        points += domino.left + domino.right;
                    }
                    
                    if (points < minPoints) {
                        minPoints = points;
                        winner = player;
                    }
                }
                
                return winner;
            } else {
                // Ø¦Û•Ùˆ Ú©Û•Ø³Û•ÛŒ Ø¯Û†Ù…ÛŒÙ†Û•Ú©Ø§Ù†ÛŒ ØªÛ•ÙˆØ§Ùˆ Ú©Ø±Ø¯ÙˆÙˆÛ•
                for (let player of gameState.players) {
                    if (player.hand.length === 0) {
                        return player;
                    }
                }
            }
            
            return null;
        }

        function backToMenu() {
            document.getElementById('menu').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
            
            // Ú•ÛŒØ³ÛØª Ú©Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒ
            gameState = {
                players: [],
                currentPlayer: 0,
                playerCount: 2,
                dominoSet: [],
                playedDominoes: [],
                gameLines: [],
                leftEnds: [],
                rightEnds: [],
                gameStarted: false,
                gameOver: false,
                isComputerGame: true,
                knockCount: 0,
                lastPlayedSide: 'main'
            };
        }
        // Ø¯Û•Ø³ØªÚ©Ø±Ø¯ÛŒ ÛŒØ§Ø±ÛŒ Ø¨Û• Ø¯Û•Ø±Ú©Ø±Ø¯Ù†ÛŒ ÛŒÛ•Ú©Û•Ù… Ø¯Û†Ù…ÛŒÙ†Û•
        function autoPlayFirstDomino() {
            const currentPlayer = gameState.players[gameState.currentPlayer];
            
            // Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯ÙˆÙˆØ¨Úµ
            let highestDouble = -1;
            let doubleIndex = -1;
            
            for (let i = 0; i < currentPlayer.hand.length; i++) {
                const domino = currentPlayer.hand[i];
                if (domino.isDouble && domino.left > highestDouble) {
                    highestDouble = domino.left;
                    doubleIndex = i;
                }
            }
            
            if (doubleIndex !== -1) {
                // ÛŒØ§Ø±ÛŒ Ø¨Û• Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯ÙˆÙˆØ¨Úµ
                setTimeout(() => {
                    if (currentPlayer.isHuman) {
                        // ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ù…Ø±Û†Ú¤ Ø®Û†ÛŒ Ø¯Û•ÛŒÚ©Ø§Øª
                        updateDisplay();
                    } else {
                        playDomino(doubleIndex);
                    }
                }, 1000);
            } else {
                // Ø¦Û•Ú¯Û•Ø± Ø¯ÙˆÙˆØ¨ÚµÛŒ Ù†Û•Ø¨ÛØªØŒ Ø¨Û•Ø±Ø²ØªØ±ÛŒÙ† Ø¯Û†Ù…ÛŒÙ†Û•
                let highestSum = -1;
                let highestIndex = -1;
                
                for (let i = 0; i < currentPlayer.hand.length; i++) {
                    const domino = currentPlayer.hand[i];
                    if (domino.left + domino.right > highestSum) {
                        highestSum = domino.left + domino.right;
                        highestIndex = i;
                    }
                }
                
                setTimeout(() => {
                    if (currentPlayer.isHuman) {
                        updateDisplay();
                    } else {
                        playDomino(highestIndex);
                    }
                }, 1000);
            }
        }

        // Ø¨Û•Ø±ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒÛŒ ØªÛ•Ù†Ø¯Ø±ÙˆØ³Øª
        function checkGameBlocked() {
            // Ø¨Ù¾Ø´Ú©Ù†ÛŒÙ† Ø¦Ø§ÛŒØ§ ÛŒØ§Ø±ÛŒ Ø¨Ù„Û†Ú© Ø¨ÙˆÙˆÛ• (Ù‡Û•Ù…ÙˆÙˆ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Ø§Ù† Ù†Ø§ØªÙˆØ§Ù†Ù† ÛŒØ§Ø±ÛŒ Ø¨Ú©Û•Ù†)
            let playersCanPlay = 0;
            
            for (let player of gameState.players) {
                let canPlay = false;
                for (let domino of player.hand) {
                    if (canPlayDomino(domino)) {
                        canPlay = true;
                        break;
                    }
                }
                if (canPlay) playersCanPlay++;
            }
            
            return playersCanPlay === 0;
        }

        // Ú†Ø§Ú©Ú©Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒ Ø¨Û† ÛŒÛ•Ú©Û•Ù… Ø¬Ø§Ø±
        function initializeFirstPlay() {
            if (gameState.playedDominoes.length === 0) {
                autoPlayFirstDomino();
            } else {
                updateDisplay();
                
                if (gameState.isComputerGame && !gameState.players[gameState.currentPlayer].isHuman) {
                    setTimeout(computerPlay, 1000);
                }
            }
        }

        // Ú†Ø§Ú©Ú©Ø±Ø¯Ù†ÛŒ ÙÛ•Ù†Ú©Ø´Ù†ÛŒ startGame
        function startGame(playerCount, withComputer = true) {
            gameState.playerCount = playerCount;
            gameState.isComputerGame = withComputer && playerCount === 2;
            gameState.dominoSet = createDominoSet();
            gameState.playedDominoes = [];
            gameState.gameLines = [[]];
            gameState.leftEnds = [];
            gameState.rightEnds = [];
            gameState.currentPlayer = 0;
            gameState.gameStarted = true;
            gameState.gameOver = false;
            gameState.knockCount = 0;

            // Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†Ø§Ù†
            gameState.players = [];
            for (let i = 0; i < playerCount; i++) {
                const isHuman = gameState.isComputerGame ? i === 0 : true;
                gameState.players.push({
                    id: i,
                    name: gameState.isComputerGame && i === 1 ? 'Ø³ÛŒØ³ØªÙ…' : i === 0 ? 'ØªÛ†' : `ÛŒØ§Ø±ÛŒØ²Ø§Ù† ${i + 1}`,
                    hand: [],
                    isHuman: isHuman,
                    hasKnocked: false
                });
            }

            // Ø¯Ø§Ø¨Û•Ø´Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û•Ú©Ø§Ù† (7 Ø¯Û†Ù…ÛŒÙ†Û• Ø¨Û† Ù‡Û•Ø± ÛŒØ§Ø±ÛŒØ²Ø§Ù†)
            for (let i = 0; i < 7; i++) {
                for (let j = 0; j < playerCount; j++) {
                    if (gameState.dominoSet.length > 0) {
                        gameState.players[j].hand.push(gameState.dominoSet.pop());
                    }
                }
            }

            // Ù†Ø§Ø±Ù†Ø§Ø³Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û†Ù…ÛŒÙ†Û•Ú©Ø§Ù†
            gameState.players.forEach(player => {
                player.hand.sort((a, b) => {
                    if (a.isDouble && !b.isDouble) return -1;
                    if (!a.isDouble && b.isDouble) return 1;
                    return (b.left + b.right) - (a.left + a.right);
                });
            });

            // Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ ÛŒØ§Ø±ÛŒØ²Ø§Ù†ÛŒ Ø¯Û•Ø³Øª Ù¾ÛÚ©Û•Ø±
            findStartingPlayer();

            // Ø´Ø§Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù…ÛÙ†ÛŒÙˆ Ùˆ Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ ÛŒØ§Ø±ÛŒ
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';

            // Ø¯Û•Ø³Øª Ù¾ÛÚ©Ø±Ø¯Ù†ÛŒ ÛŒØ§Ø±ÛŒ
            initializeFirstPlay();
        }
    </script>
</body>